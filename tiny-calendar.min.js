"use strict";angular.module("angular-tiny-calendar",[]).directive("tinyCalendar",[function(){function a(a){return a.startOf("day")}function b(a,b){for(var c=null,d=0;d<a.length;d++){if(b&&a[d].date===b){c=a[d];break}if(!b&&a[d].isToday){c=a[d];break}}return c}function c(b,c,e){e&&!isNaN(e)||(e=0);for(var f=[],g=a(b.clone().date(0).day(e)),h=0;h<42;h++)f.push({number:g.date(),isCurrentMonth:g.month()===b.month(),isToday:g.isSame(moment().format(),"day"),date:g.format()}),g=g.clone(),g.add(1,"d");return d(f,c)}function d(b,c){return c?b.map(function(b){var d=[],e=moment(b.date);return c.forEach(function(b){var c=a(moment(b.startDate)),f=b.endDate?a(moment(b.endDate)):c.clone();moment().range(c,f).contains(e)&&d.push(b)}),d.length>0&&(b.events=d),b}):b}return{restrict:"A",scope:{events:"=",selected:"="},template:function(a,b){var c={weekDays:"SMTWTFS",today:"today",allDayLabel:"All day",firstDay:0};for(var d in c)void 0===b[d]&&(b[d]=c[d]);b.weekDays=b.weekDays.split("").slice(0,7),b.firstDay&&(b.weekDays=b.weekDays.slice(b.firstDay).concat(b.weekDays.slice(0,b.firstDay))),b.weekDays="["+b.weekDays.map(function(a){return'"'+a+'"'}).join(",").replace('"',"&quot;")+"]";var e="<div class='tc-container'>";return e+="<div class='tc-header'>{{currentMonth.format('MMMM YYYY')}}",e+="<div class='tc-navigation'>",e+="<button ng-click='previous()'>«</button>",e+="<button ng-click='today()'>"+b.today+"</button>",e+="<button ng-click='next()'>»</button>",e+="</div>",e+="</div>",e+="<div class='tc-days-name'>",e+="<div class='tc-day-name' ng-repeat='wd in "+b.weekDays+" track by $index'>{{wd}}</div>",e+="</div>",e+="<div class='tc-days'>",e+="<div ng-repeat='day in month' class='tc-day' ng-class='{ today: day.isToday, differentMonth: !day.isCurrentMonth, selected: day.date === selected.date, hasEvents: day.events.length > 0}' ng-click='select(day)'>{{day.number}}</div>",e+="</div>",e+="<div class='tc-focus' ng-show='selected.events'>",e+="<ul>",e+="<li ng-repeat='e in selected.events | orderBy:&quot;date&quot;'><span class='tc-time' ng-show='e.time'>{{e.time}}</span><span class='tc-time' ng-hide='e.time'>"+b.allDayLabel+"</span><span class='tc-title' ng-bind-html='e.title'></span></li>",e+="</ul>",e+="</div>",e+="</div>"},link:function(d,e,f){var g=moment().format();d.currentMonth=moment();var h=d.currentMonth.clone();d.month=c(h,d.events,f.firstDay),d.selected=b(d.month),d.select=function(a){a.isCurrentMonth?d.selected=a:(d.currentMonth=moment(a.date),d.month=c(d.currentMonth,d.events),d.selected=b(d.month,a.date))},d.today=function(){d.currentMonth=moment(g),d.month=c(d.currentMonth,d.events),d.selected=b(d.month,a(d.currentMonth).format())},d.previous=function(){d.selected=null,d.currentMonth.subtract(1,"months"),d.month=c(d.currentMonth,d.events)},d.next=function(){d.selected=null,d.currentMonth.add(1,"months"),d.month=c(d.currentMonth,d.events)}}}}]);